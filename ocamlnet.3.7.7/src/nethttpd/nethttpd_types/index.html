<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="../../../../codoc.css"/>
    <title>Nethttpd_types</title>
  </head>
  <body>

  <div class="module codoc-doc">
      <a href="../../../">Up</a>
      <div class="intro"><h1 class="title"><span class="keyword">module</span> <a href="">Nethttpd_types</a></h1> : <span class="keyword">sig</span></div>
      
      <div class="doc">
        
      <p>Type definitions for the HTTP daemon</p>
      
      <p><b>Contents</b></p>
      <ul><li><a href="../../../../ocamlnet.3.7.7/src/nethttpd/nethttpd_types/">Nethttpd_types</a>.<a href="../../../../ocamlnet.3.7.7/src/nethttpd/nethttpd_types/#/label:exceptions">exceptions</a></li><li><a href="../../../../ocamlnet.3.7.7/src/nethttpd/nethttpd_types/">Nethttpd_types</a>.<a href="../../../../ocamlnet.3.7.7/src/nethttpd/nethttpd_types/#/label:environment">environment</a></li><li><a href="../../../../ocamlnet.3.7.7/src/nethttpd/nethttpd_types/">Nethttpd_types</a>.<a href="../../../../ocamlnet.3.7.7/src/nethttpd/nethttpd_types/#/label:service">service</a></li><li><a href="../../../../ocamlnet.3.7.7/src/nethttpd/nethttpd_types/">Nethttpd_types</a>.<a href="../../../../ocamlnet.3.7.7/src/nethttpd/nethttpd_types/#/label:helpers">helpers</a></li></ul>
        
      </div>
    
      
    <div class="sig">
      <div class="doc">
        
      <p>Many types can also be found in the <code>Nethttp</code> module (part of netstring).
Furthermore, <code>Netcgi_env</code> and <code>Netcgi_types</code> are of interest (part of cgi).</p>
      
        
      </div>
    
      <div class="doc">
        
  <div class="region" id="/label:exceptions">
  <a href="index.html#/label:exceptions" class="anchor">#</a>
  
    <h1 class="section level_1">Exceptions</h1>
    
  </div>
  
        
      </div>
    
  <div class="region" id="/exn:Standard_response">
  <a href="index.html#/exn:Standard_response" class="anchor">#</a>
  
  <div class="exn">
    <span class="keyword">exception</span> Standard_response <span class="keyword">of</span> <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/type:http_status">http_status</a> * <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/classtype:http_header">http_header</a> option * string option
    
      <div class="doc">
        
      <p>Some HTTP containers allow you to raise this exception. The standard
response corresponding to <code>http_status</code> is sent back to the client.
If the third argument exists, an entry into the error log
is written.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
      <div class="doc">
        
  <div class="region" id="/label:environment">
  <a href="index.html#/label:environment" class="anchor">#</a>
  
    <h1 class="section level_1">Environment</h1>
    
  </div>
  
        
      </div>
    
  <div class="region" id="/type:output_state">
  <a href="index.html#/type:output_state" class="anchor">#</a>
  
  <div class="type">
    <span class="keyword">type</span> output_state = [ <div class="cons">| `Start</div><div class="cons">| `Sending</div><div class="cons">| `End</div> ]
    
  </div>
  
  </div>
  
  <div class="region" id="/val:string_of_output_state">
  <a href="index.html#/val:string_of_output_state" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> string_of_output_state : <a href="index.html#/type:output_state">output_state</a> <span class="rarr"><span>-&gt;</span></span> string
    
      <div class="doc">
        
      <p>Debugging</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:v_extended_environment">
  <a href="index.html#/classtype:v_extended_environment" class="anchor">#</a>
  
  <div class="classtype">
    <span class="keyword">class type</span> <span class="keyword">virtual</span> v_extended_environment = 
    <div class="inherit">
    <span class="keyword">inherit</span> <a href="../../../../ocamlnet.3.7.7/src/netcgi2/netcgi/">Netcgi</a>.<a href="../../../../ocamlnet.3.7.7/src/netcgi2/netcgi/#/classtype:cgi_environment">cgi_environment</a>
    </div>
    
  <div class="region" id="/classtype:v_extended_environment/method:server_socket_addr">
  <a href="index.html#/classtype:v_extended_environment/method:server_socket_addr" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> <span class="keyword">virtual</span> server_socket_addr : <a href="../../../../ocaml.4.02.1+doc/otherlibs/unix/unix/">Unix</a>.<a href="../../../../ocaml.4.02.1+doc/otherlibs/unix/unix/#/type:sockaddr">sockaddr</a>
  
  </div>
  
  </div>
  
  <div class="region" id="/classtype:v_extended_environment/method:remote_socket_addr">
  <a href="index.html#/classtype:v_extended_environment/method:remote_socket_addr" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> <span class="keyword">virtual</span> remote_socket_addr : <a href="../../../../ocaml.4.02.1+doc/otherlibs/unix/unix/">Unix</a>.<a href="../../../../ocaml.4.02.1+doc/otherlibs/unix/unix/#/type:sockaddr">sockaddr</a>
  
      <div class="doc">
        
      <p>These are always the physical IP addresses and ports of the two endpoints
of the current connection.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:v_extended_environment/method:cgi_request_uri">
  <a href="index.html#/classtype:v_extended_environment/method:cgi_request_uri" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> cgi_request_uri : string
  
      <div class="doc">
        
      <p>The full request URI. Identical to the CGI property &quot;REQUEST_URI&quot;</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:v_extended_environment/method:log_props">
  <a href="index.html#/classtype:v_extended_environment/method:log_props" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> log_props : (string * string) list <span class="rarr"><span>-&gt;</span></span> unit
  
      <div class="doc">
        
      <p>Remember this version of <code>cgi_properties</code> as the one sent to the
<code>config_log_access</code> function</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:v_extended_environment/method:input_channel">
  <a href="index.html#/classtype:v_extended_environment/method:input_channel" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> input_channel : <a href="../../../../ocamlnet.3.7.7/src/netstring/netchannels/">Netchannels</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/netchannels/#/classtype:in_obj_channel">in_obj_channel</a>
  
      <div class="doc">
        
      <p>The input channel for reading the body of the request</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:v_extended_environment/method:input_body_size">
  <a href="index.html#/classtype:v_extended_environment/method:input_body_size" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> input_body_size : int64
  
      <div class="doc">
        
      <p>so far known, or 0L</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:v_extended_environment/method:request_body_rejected">
  <a href="index.html#/classtype:v_extended_environment/method:request_body_rejected" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> request_body_rejected : bool
  
      <div class="doc">
        
      <p>so far known, or false</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:v_extended_environment/method:send_file">
  <a href="index.html#/classtype:v_extended_environment/method:send_file" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> send_file : <a href="../../../../ocaml.4.02.1+doc/otherlibs/unix/unix/">Unix</a>.<a href="../../../../ocaml.4.02.1+doc/otherlibs/unix/unix/#/type:file_descr">file_descr</a> <span class="rarr"><span>-&gt;</span></span> int64 <span class="rarr"><span>-&gt;</span></span> unit
  
      <div class="doc">
        
      <p>Sends the output header with a file as body. The file must already be open,
and positioned where the transmission begins. The number is the length
of the transmission.</p>
      
      <p>This method may return immediately when it is possible to open the file, and
to set the kernel up for file transmission. Otherwise a <code>Unix_error</code> is
raised. It is also allowed that this method blocks until the file is actually
transmitted.</p>
      
      <p>It is not allowed to print to the output channel and to call <code>send_file</code>.
Only one transmission method must be invoked.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:v_extended_environment/method:output_state">
  <a href="index.html#/classtype:v_extended_environment/method:output_state" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> <span class="keyword">virtual</span> output_state : <a href="index.html#/type:output_state">output_state</a> <a href="../../../../ocaml.4.02.1+doc/stdlib/pervasives/">Pervasives</a>.<a href="../../../../ocaml.4.02.1+doc/stdlib/pervasives/#/type:ref">ref</a>
  
      <div class="doc">
        
      <p>Reflects the state of the output generation:</p>
      <ul><li><code>`Start</code>: Nothing is generated yet</li><li><code>`Sending</code>: Output is already being sent</li><li><code>`End</code>: The response (for a single request) has been fully sent</li></ul>
        
      </div>
    
  </div>
  
  </div>
  
    
      <div class="doc">
        
      <p>An extension of <code>cgi_environment</code> for use with the daemon. The methods
retrieving the socket addresses are virtual.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:extended_environment">
  <a href="index.html#/classtype:extended_environment" class="anchor">#</a>
  
  <div class="classtype">
    <span class="keyword">class type</span> extended_environment = 
    <div class="inherit">
    <span class="keyword">inherit</span> <a href="index.html#/classtype:v_extended_environment">v_extended_environment</a>
    </div>
    
  <div class="region" id="/classtype:extended_environment/method:server_socket_addr">
  <a href="index.html#/classtype:extended_environment/method:server_socket_addr" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> server_socket_addr : <a href="../../../../ocaml.4.02.1+doc/otherlibs/unix/unix/">Unix</a>.<a href="../../../../ocaml.4.02.1+doc/otherlibs/unix/unix/#/type:sockaddr">sockaddr</a>
  
  </div>
  
  </div>
  
  <div class="region" id="/classtype:extended_environment/method:remote_socket_addr">
  <a href="index.html#/classtype:extended_environment/method:remote_socket_addr" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> remote_socket_addr : <a href="../../../../ocaml.4.02.1+doc/otherlibs/unix/unix/">Unix</a>.<a href="../../../../ocaml.4.02.1+doc/otherlibs/unix/unix/#/type:sockaddr">sockaddr</a>
  
  </div>
  
  </div>
  
  <div class="region" id="/classtype:extended_environment/method:output_state">
  <a href="index.html#/classtype:extended_environment/method:output_state" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> output_state : <a href="index.html#/type:output_state">output_state</a> <a href="../../../../ocaml.4.02.1+doc/stdlib/pervasives/">Pervasives</a>.<a href="../../../../ocaml.4.02.1+doc/stdlib/pervasives/#/type:ref">ref</a>
  
  </div>
  
  </div>
  
    
      <div class="doc">
        
      <p>Same as <code>v_extended_environment</code>, but no virtual methods</p>
      
        
      </div>
    
  </div>
  
  </div>
  
      <div class="doc">
        <div class="region">
    <h2 class="section level_2">Construction of environments</h2>
    </div>
        
      </div>
    
  <div class="region" id="/class:empty_environment">
  <a href="index.html#/class:empty_environment" class="anchor">#</a>
  
  <div class="class">
    <span class="keyword">class</span> <span class="keyword">virtual</span> empty_environment : 
    <div class="inherit">
    <span class="keyword">inherit</span> <a href="index.html#/classtype:v_extended_environment">v_extended_environment</a>
    </div>
    
  <div class="region" id="/class:empty_environment/var:config">
  <a href="index.html#/class:empty_environment/var:config" class="anchor">#</a>
  
  <div class="classval">
  <span class="keyword">val</span> <span class="keyword">mutable</span> config : <a href="../../../../ocamlnet.3.7.7/src/netcgi2/netcgi/">Netcgi</a>.<a href="../../../../ocamlnet.3.7.7/src/netcgi2/netcgi/#/type:config">config</a>
  
  </div>
  
  </div>
  
  <div class="region" id="/class:empty_environment/var:protocol">
  <a href="index.html#/class:empty_environment/var:protocol" class="anchor">#</a>
  
  <div class="classval">
  <span class="keyword">val</span> <span class="keyword">mutable</span> protocol : <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/type:protocol">protocol</a>
  
  </div>
  
  </div>
  
  <div class="region" id="/class:empty_environment/var:in_header">
  <a href="index.html#/class:empty_environment/var:in_header" class="anchor">#</a>
  
  <div class="classval">
  <span class="keyword">val</span> <span class="keyword">mutable</span> in_header : <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/classtype:http_header">http_header</a>
  
  </div>
  
  </div>
  
  <div class="region" id="/class:empty_environment/var:out_header">
  <a href="index.html#/class:empty_environment/var:out_header" class="anchor">#</a>
  
  <div class="classval">
  <span class="keyword">val</span> <span class="keyword">mutable</span> out_header : <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/classtype:http_header">http_header</a>
  
  </div>
  
  </div>
  
  <div class="region" id="/class:empty_environment/var:properties">
  <a href="index.html#/class:empty_environment/var:properties" class="anchor">#</a>
  
  <div class="classval">
  <span class="keyword">val</span> <span class="keyword">mutable</span> properties : (string * string) list
  
  </div>
  
  </div>
  
  <div class="region" id="/class:empty_environment/var:in_channel">
  <a href="index.html#/class:empty_environment/var:in_channel" class="anchor">#</a>
  
  <div class="classval">
  <span class="keyword">val</span> <span class="keyword">mutable</span> in_channel : <a href="../../../../ocamlnet.3.7.7/src/netstring/netchannels/">Netchannels</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/netchannels/#/classtype:in_obj_channel">in_obj_channel</a>
  
  </div>
  
  </div>
  
  <div class="region" id="/class:empty_environment/var:out_channel">
  <a href="index.html#/class:empty_environment/var:out_channel" class="anchor">#</a>
  
  <div class="classval">
  <span class="keyword">val</span> <span class="keyword">mutable</span> out_channel : <a href="../../../../ocamlnet.3.7.7/src/netstring/netchannels/">Netchannels</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/netchannels/#/classtype:out_obj_channel">out_obj_channel</a>
  
  </div>
  
  </div>
  
    
      <div class="doc">
        
      <p>This class implements an environment with defined internal containers.
These containers are empty, but fully functional.
The following methods are empty and should be redefined:</p>
      <ul><li><code>send_output_header</code></li><li><code>send_file</code></li><li><code>log_error</code></li><li><code>log_props</code></li></ul>
      <p>The virtual methods, of course, must be defined!</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/class:redirected_environment">
  <a href="index.html#/class:redirected_environment" class="anchor">#</a>
  
  <div class="class">
    <span class="keyword">class</span> redirected_environment : 
    ?in_header:<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/classtype:http_header">http_header</a> option
    <span class="rarr"><span>-&gt;</span></span>
    
    ?properties:(string * string) list option
    <span class="rarr"><span>-&gt;</span></span>
    
    ?in_channel:<a href="../../../../ocamlnet.3.7.7/src/netstring/netchannels/">Netchannels</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/netchannels/#/classtype:in_obj_channel">in_obj_channel</a> option
    <span class="rarr"><span>-&gt;</span></span>
    
    <a href="index.html#/classtype:extended_environment">extended_environment</a>
    <span class="rarr"><span>-&gt;</span></span>
    <a href="index.html#/classtype:extended_environment">extended_environment</a>
    
    
    
    
    
      <div class="doc">
        
      <p>This class overlays the input-side containers of an existing environment.
The output-side containers (<code>out_header</code>, and <code>out_channel</code>)
are physically identical with the existing environment.</p>
      
      <p>If one of the argument is not passed on class instantiation, the corresponding
overlay container is initialized with the current value of the passed
environment. As exception of this rule, the input channel is initialized with
an empty input channel.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
      <div class="doc">
        <div class="region">
    <h2 class="section level_2">Auxiliary Functions for Environments</h2>
    </div>
        
      </div>
    
  <div class="region" id="/val:output_static_response">
  <a href="index.html#/val:output_static_response" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> output_static_response : <a href="index.html#/classtype:extended_environment">extended_environment</a> <span class="rarr"><span>-&gt;</span></span> <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/type:http_status">http_status</a> <span class="rarr"><span>-&gt;</span></span> <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/classtype:http_header">http_header</a> option <span class="rarr"><span>-&gt;</span></span> string <span class="rarr"><span>-&gt;</span></span> unit
    
      <div class="doc">
        
      <p>Outputs the string argument as response body, together with the given status and
the header (optional). Response header fields are set as follows:</p>
      <ul><li>The <code>Content-Length</code> is set to the length of the string.</li><li>The <code>Content-Type</code> is set to &quot;text/html&quot; unless given by the header.</li></ul>
      <p>If the header is not passed, the header of the environment is taken. If the header
argument exists, however, it overrides the header of the environment.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:output_file_response">
  <a href="index.html#/val:output_file_response" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> output_file_response : <a href="index.html#/classtype:extended_environment">extended_environment</a> <span class="rarr"><span>-&gt;</span></span> <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/type:http_status">http_status</a> <span class="rarr"><span>-&gt;</span></span> <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/classtype:http_header">http_header</a> option <span class="rarr"><span>-&gt;</span></span> string <span class="rarr"><span>-&gt;</span></span> int64 <span class="rarr"><span>-&gt;</span></span> int64 <span class="rarr"><span>-&gt;</span></span> unit
    
      <div class="doc">
        
      <p>Outputs the contents of a file as response body, together with the given status and
the header (optional). The string is the file name. The first int64 number is
the position in the file where to start, and the second number is the length
of the body. Response header fields are set as follows:</p>
      <ul><li>The <code>Content-Length</code> is set to the length of the string.</li><li>The <code>Content-Type</code> is set to &quot;text/html&quot; unless given by the header.</li></ul>
      <p>Note that <code>Content-Range</code> is not set automatically, even if the file is only
partially transferred.</p>
      
      <p>If the header is not passed, the header of the environment is taken. If the header
argument exists, however, it overrides the header of the environment.</p>
      
      <p>The function raises <code>Sys_error</code> when the file cannot be read.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
      <div class="doc">
        <div class="region">
    <h1 class="section level_1">Generating error responses, logging</h1>
    </div>
        
      </div>
    
  <div class="region" id="/classtype:request_info">
  <a href="index.html#/classtype:request_info" class="anchor">#</a>
  
  <div class="classtype">
    <span class="keyword">class type</span> request_info = 
  <div class="region" id="/classtype:request_info/method:server_socket_addr">
  <a href="index.html#/classtype:request_info/method:server_socket_addr" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> server_socket_addr : <a href="../../../../ocaml.4.02.1+doc/otherlibs/unix/unix/">Unix</a>.<a href="../../../../ocaml.4.02.1+doc/otherlibs/unix/unix/#/type:sockaddr">sockaddr</a>
  
      <div class="doc">
        
      <p>The socket address of this server. May raise <code>Not_found</code> if
there is no such address</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:request_info/method:remote_socket_addr">
  <a href="index.html#/classtype:request_info/method:remote_socket_addr" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> remote_socket_addr : <a href="../../../../ocaml.4.02.1+doc/otherlibs/unix/unix/">Unix</a>.<a href="../../../../ocaml.4.02.1+doc/otherlibs/unix/unix/#/type:sockaddr">sockaddr</a>
  
      <div class="doc">
        
      <p>The socket address of the client. May raise <code>Not_found</code> if
there is no such address</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:request_info/method:request_method">
  <a href="index.html#/classtype:request_info/method:request_method" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> request_method : string
  
      <div class="doc">
        
      <p>The method like <code>GET</code>. May raise <code>Not_found</code></p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:request_info/method:request_uri">
  <a href="index.html#/classtype:request_info/method:request_uri" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> request_uri : string
  
      <div class="doc">
        
      <p>The URI of the client request. This is often without the
server designation, i.e. just <code>/path?query</code>.
May raise <code>Not_found</code></p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:request_info/method:input_header">
  <a href="index.html#/classtype:request_info/method:input_header" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> input_header : <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/classtype:http_header">http_header</a>
  
      <div class="doc">
        
      <p>The request header. May raise <code>Not_found</code></p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:request_info/method:cgi_properties">
  <a href="index.html#/classtype:request_info/method:cgi_properties" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> cgi_properties : (string * string) list
  
      <div class="doc">
        
      <p>The distilled CGI properties</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:request_info/method:input_body_size">
  <a href="index.html#/classtype:request_info/method:input_body_size" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> input_body_size : int64
  
      <div class="doc">
        
      <p>The size of the input body. May raise <code>Not_found</code></p>
      
        
      </div>
    
  </div>
  
  </div>
  
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:full_info">
  <a href="index.html#/classtype:full_info" class="anchor">#</a>
  
  <div class="classtype">
    <span class="keyword">class type</span> full_info = 
    <div class="inherit">
    <span class="keyword">inherit</span> <a href="index.html#/classtype:request_info">request_info</a>
    </div>
    
  <div class="region" id="/classtype:full_info/method:response_status_code">
  <a href="index.html#/classtype:full_info/method:response_status_code" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> response_status_code : int
  
      <div class="doc">
        
      <p>The HTTP status code to response</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:full_info/method:request_body_rejected">
  <a href="index.html#/classtype:full_info/method:request_body_rejected" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> request_body_rejected : bool
  
      <div class="doc">
        
      <p>Whether the request body was rejected</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:full_info/method:output_header">
  <a href="index.html#/classtype:full_info/method:output_header" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> output_header : <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/classtype:http_header">http_header</a>
  
      <div class="doc">
        
      <p>The response header</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:full_info/method:output_body_size">
  <a href="index.html#/classtype:full_info/method:output_body_size" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> output_body_size : int64
  
      <div class="doc">
        
      <p>The size of the output body.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
    
  </div>
  
  </div>
  
  <div class="region" id="/class:create_full_info">
  <a href="index.html#/class:create_full_info" class="anchor">#</a>
  
  <div class="class">
    <span class="keyword">class</span> create_full_info : 
    response_status_code:int
    <span class="rarr"><span>-&gt;</span></span>
    
    request_body_rejected:bool
    <span class="rarr"><span>-&gt;</span></span>
    
    output_header:<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/classtype:http_header">http_header</a>
    <span class="rarr"><span>-&gt;</span></span>
    
    output_body_size:int64
    <span class="rarr"><span>-&gt;</span></span>
    
    <a href="index.html#/classtype:request_info">request_info</a>
    <span class="rarr"><span>-&gt;</span></span>
    <a href="index.html#/classtype:full_info">full_info</a>
    
    
    
    
    
    
      <div class="doc">
        
      <p>Creates a <code>full_info</code> object by adding to a <code>request_info</code> object</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:error_response_params">
  <a href="index.html#/classtype:error_response_params" class="anchor">#</a>
  
  <div class="classtype">
    <span class="keyword">class type</span> error_response_params = 
    <div class="inherit">
    <span class="keyword">inherit</span> <a href="index.html#/classtype:request_info">request_info</a>
    </div>
    
  <div class="region" id="/classtype:error_response_params/method:response_status_code">
  <a href="index.html#/classtype:error_response_params/method:response_status_code" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> response_status_code : int
  
      <div class="doc">
        
      <p>The HTTP status code to response</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:error_response_params/method:error_message">
  <a href="index.html#/classtype:error_response_params/method:error_message" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> error_message : string
  
      <div class="doc">
        
      <p>The error message explaining the detail that went wrong</p>
      
        
      </div>
    
  </div>
  
  </div>
  
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:min_config">
  <a href="index.html#/classtype:min_config" class="anchor">#</a>
  
  <div class="classtype">
    <span class="keyword">class type</span> min_config = 
  <div class="region" id="/classtype:min_config/method:config_error_response">
  <a href="index.html#/classtype:min_config/method:config_error_response" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> config_error_response : <a href="index.html#/classtype:error_response_params">error_response_params</a> <span class="rarr"><span>-&gt;</span></span> string
  
  </div>
  
  </div>
  
  <div class="region" id="/classtype:min_config/method:config_log_error">
  <a href="index.html#/classtype:min_config/method:config_log_error" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> config_log_error : <a href="index.html#/classtype:request_info">request_info</a> <span class="rarr"><span>-&gt;</span></span> string <span class="rarr"><span>-&gt;</span></span> unit
  
  </div>
  
  </div>
  
    
      <div class="doc">
        
      <p>Minimal configuration needed for <code>output_std_response</code></p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:output_std_response">
  <a href="index.html#/val:output_std_response" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> output_std_response : <a href="index.html#/classtype:min_config">min_config</a> <span class="rarr"><span>-&gt;</span></span> <a href="index.html#/classtype:extended_environment">extended_environment</a> <span class="rarr"><span>-&gt;</span></span> <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/type:http_status">http_status</a> <span class="rarr"><span>-&gt;</span></span> <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/classtype:http_header">http_header</a> option <span class="rarr"><span>-&gt;</span></span> string option <span class="rarr"><span>-&gt;</span></span> unit
    
      <div class="doc">
        
      <p>Outputs a &quot;standard response&quot; for the <code>http_status</code>. The string argument
is an optional entry into the error log.</p>
      
      <p>If the header is not passed, an empty header is taken. If the header argument
exists, this header is taken. The header of the environment is never taken.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
      <div class="doc">
        
  <div class="region" id="/label:service">
  <a href="index.html#/label:service" class="anchor">#</a>
  
    <h1 class="section level_1">Service Providers</h1>
    
  </div>
  
      <p>Service providers are defined using the three class types:</p>
      <ul><li><code>http_service</code>: The service provider as such. When a HTTP header has been
received, and the service provider is invoked, it returns an object
fitting to the next class type, <code>http_service_receiver</code>. This object
is tagged with <code>`Accept_body</code>; at this point there are also alternate ways
of processing, see below.</li><li><code>http_service_receiver</code>: The task of this object is to receive the request
body. When the body has been completely received, the object is notified,
and returns a third object of type <code>http_service_generator</code>.</li><li><code>http_service_generator</code>: The task of this object is to generate the
response.</li></ul>
      <p>An implementor is free to define only one class that satisfies all three
class types at once. However, this is only an option.</p>
      
      <p>The three objects reflect three stages of HTTP processing. The stages have
made explicit to allow the implementor of services to intercept the points
in time when the processing of the next stage begins. Furthermore, in multi-threaded
environments it is allowed that the stages are performed in the contexts of
different threads.</p>
      
      <p>In addition to the three-stage model there also several faster paths of
processing:</p>
      <ul><li><code>`Reject_body</code> can be used to refuse the acceptance of the request body when
it is already clear that an error response is sent back. This path skips
the stage <code>http_service_receiver</code>.</li><li><code>`Static</code> can be used to send a constant string back (only to be used
when the string needs not to be computed)</li><li><code>`File</code> can be used to send the contents of a file back (only to be used
when the file already exists)</li></ul>
        
      </div>
    
  <div class="region" id="/exn:Redirect_request">
  <a href="index.html#/exn:Redirect_request" class="anchor">#</a>
  
  <div class="exn">
    <span class="keyword">exception</span> Redirect_request <span class="keyword">of</span> string * <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/classtype:http_header">http_header</a>
    
      <div class="doc">
        
      <p>The &quot;early&quot; redirect is only allowed in stage 1 of HTTP processing.
The string argument is the new URI path of the request. The header can also
be exchanged except the fields that are needed to decode the request
body. It is not possible to change the method.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/exn:Redirect_response">
  <a href="index.html#/exn:Redirect_response" class="anchor">#</a>
  
  <div class="exn">
    <span class="keyword">exception</span> Redirect_response <span class="keyword">of</span> string * <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/classtype:http_header">http_header</a>
    
      <div class="doc">
        
      <p>The &quot;late&quot; redirect is only allowed in stage 3 of HTTP processing.
The string argument is the new URI path of the request. The header can also
be exchanged except the fields that are needed to decode the request
body. <b>The method is always changed to <code>GET</code>.</b></p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:http_service_generator">
  <a href="index.html#/classtype:http_service_generator" class="anchor">#</a>
  
  <div class="classtype">
    <span class="keyword">class type</span> http_service_generator = 
  <div class="region" id="/classtype:http_service_generator/method:generate_response">
  <a href="index.html#/classtype:http_service_generator/method:generate_response" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> generate_response : <a href="index.html#/classtype:extended_environment">extended_environment</a> <span class="rarr"><span>-&gt;</span></span> unit
  
      <div class="doc">
        
      <p>Third stage of HTTP processing:
This method is called when the HTTP request has been completely received,
and the response is going to be generated. This method can again be called
from a different thread than the previous stages. It is allowed to spend
any necessary time to compute the response.</p>
      
      <p>When the method returns, the request processing is finished. No more data
is allowed to be written to the output channel past this moment.</p>
      
      <p>The method may raise <code>Standard_response</code> to generate one of the
standard messages.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:http_service_receiver">
  <a href="index.html#/classtype:http_service_receiver" class="anchor">#</a>
  
  <div class="classtype">
    <span class="keyword">class type</span> http_service_receiver = 
  <div class="region" id="/classtype:http_service_receiver/method:process_body">
  <a href="index.html#/classtype:http_service_receiver/method:process_body" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> process_body : <a href="index.html#/classtype:extended_environment">extended_environment</a> <span class="rarr"><span>-&gt;</span></span> <a href="index.html#/classtype:http_service_generator">http_service_generator</a>
  
      <div class="doc">
        
      <p>Second stage of HTTP processing:
This method is called when the body is expected to be arriving. Note that
the main difference to <code>process_header</code> is that this method can be
called from a different thread. It is allowed (and expected) that this method
blocks while reading the input. Of course, the input and output
channels of the environment are unlocked, and can be used.</p>
      
      <p>When the method returns, the request processing continues with stage 3.
Any body data not read is dropped.</p>
      
      <p>It is allowed that this method generates a response (or part of it),
although this should be better done in stage 3.</p>
      
      <p>The method may raise <code>Standard_response</code> to generate one of the
standard messages.</p>
      
      <p>One way of implementing this method is to instantiate <code>Netcgi.std_activation</code>.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
    
  </div>
  
  </div>
  
  <div class="region" id="/type:http_service_reaction">
  <a href="index.html#/type:http_service_reaction" class="anchor">#</a>
  
  <div class="type">
    <span class="keyword">type</span> http_service_reaction = [ <div class="cons">| `Accept_body <span class="keyword">of</span> <a href="index.html#/classtype:http_service_receiver">http_service_receiver</a></div><div class="cons">| `Reject_body <span class="keyword">of</span> <a href="index.html#/classtype:http_service_generator">http_service_generator</a></div><div class="cons">| `Static <span class="keyword">of</span> <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/type:http_status">http_status</a> * <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/classtype:http_header">http_header</a> option * string</div><div class="cons">| `File <span class="keyword">of</span> <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/type:http_status">http_status</a> * <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/classtype:http_header">http_header</a> option * string * int64 * int64</div><div class="cons">| `Std_response <span class="keyword">of</span> <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/type:http_status">http_status</a> * <a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/">Nethttp</a>.<a href="../../../../ocamlnet.3.7.7/src/netstring/nethttp/#/classtype:http_header">http_header</a> option * string option</div> ]
    
      <div class="doc">
        
      <p>Indicates the immediate reaction upon an arriving HTTP header:</p>
      <ul><li><code>`Accept_body</code> is the regular way of processing requests. If necessary,
the client is told to continue sending the rest of the request.</li><li><code>`Reject_body</code> can be used when the body of the request is not needed,
and the response will be negative.</li><li><code>`Static</code> means to send the header and a constant string back as response.
The header is taken from the environment if not explicitly passed,
Note: The <code>Content-Length</code> header is automatically added. The <code>Content-Type</code>
defaults to &quot;text/html&quot;.</li><li><code>`File</code> is similar to this, but the data come from a file. The file
is specified by an absolute pathname. The range of the file is given
by the start position and the length of the range.
The header is taken from the environment if not explicitly passed,
Note: The <code>Content-Length</code> header is automatically added. The <code>Content-Type</code>
defaults to &quot;text/html&quot;.</li><li><code>`Std_response</code> is similar to <code>`Static</code>, however the body is the standard
text for the status code. If the header is omitted, it is taken as empty.
The third argument is an optional entry into the error log.
Note: The <code>Content-Length</code> header is automatically added. The <code>Content-Type</code>
defaults to &quot;text/html&quot;.</li></ul>
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:http_service">
  <a href="index.html#/classtype:http_service" class="anchor">#</a>
  
  <div class="classtype">
    <span class="keyword">class type</span> ['a] http_service = 
  <div class="region" id="/classtype:http_service/method:name">
  <a href="index.html#/classtype:http_service/method:name" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> name : string
  
      <div class="doc">
        
      <p>The name of the type of the service provider</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:http_service/method:def_term">
  <a href="index.html#/classtype:http_service/method:def_term" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> def_term : 'a
  
      <div class="doc">
        
      <p>The definition term</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:http_service/method:print">
  <a href="index.html#/classtype:http_service/method:print" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> print : <a href="../../../../ocaml.4.02.1+doc/stdlib/format/">Format</a>.<a href="../../../../ocaml.4.02.1+doc/stdlib/format/#/type:formatter">formatter</a> <span class="rarr"><span>-&gt;</span></span> unit
  
      <div class="doc">
        
      <p>Outputs the definition term to a formatter</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:http_service/method:process_header">
  <a href="index.html#/classtype:http_service/method:process_header" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> process_header : <a href="index.html#/classtype:extended_environment">extended_environment</a> <span class="rarr"><span>-&gt;</span></span> <a href="index.html#/type:http_service_reaction">http_service_reaction</a>
  
      <div class="doc">
        
      <p>First stage of HTTP processing:
This method is called when the HTTP header has been received. This method
must return quickly without blocking the thread how to go on. For example,
this could look as follows:</p>
      <ul><li>Check whether the client is allowed to access this resource. If this
can be done immediately, it should be done now. (If an external service
must be queried, the check must not be done now, but deferred to the
second or third stage.) If the access is denied, an error response can
be sent back using <code>`Static</code>, <code>`File</code>, or, if computed, using <code>`Reject_body</code>.</li><li>Check whether the request is delegated to another service provider
(e.g. lookup by hostname, by port number, or by URI). In this case,
the result of this <code>process_header</code> call is simply the result of the
<code>process_header</code> call of the other service provider.</li><li>If this service provider generates the contents, there are mainly two
types of reaction. If the contents are stored in a file, one can simply
return <code>`File</code>. Otherwise, return <code>`Accept_body</code> to continue with the
second stage. Note that even if no body is expected to arrive, one must
go through the second stage, and drop any unexpected body.</li></ul>
      <p>The argument of this function is the Netcgi environment. The header is
complete, including the request method. One cannot access the input and
output channels at this stage of processing.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
    
  </div>
  
  </div>
  
      <div class="doc">
        
  <div class="region" id="/label:helpers">
  <a href="index.html#/label:helpers" class="anchor">#</a>
  
    <h1 class="section level_1">Helpers</h1>
    
  </div>
  
        
      </div>
    
  <div class="region" id="/val:update_alist">
  <a href="index.html#/val:update_alist" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> update_alist : ('a * 'b) list <span class="rarr"><span>-&gt;</span></span> ('a * 'b) list <span class="rarr"><span>-&gt;</span></span> ('a * 'b) list
    
      <div class="doc">
        
      <p><code>update_alist updl l</code>: Returns the alist with all elements of <code>updl</code>
and all elements of <code>l</code> that are not member of <code>updl</code>.</p>
      
        
      </div>
    
  </div>
  
  </div>
  </div>
    <div class="outro"><span class="keyword">end</span></div>
    
  </div>
  
  </body>
</html>