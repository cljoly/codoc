<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="../../../../codoc.css"/>
    <title>Shell_uq</title>
  </head>
  <body>

  <div class="module codoc-doc">
      <a href="../../../">Up</a>
      <div class="intro"><h1 class="title"><span class="keyword">module</span> <a href="">Shell_uq</a></h1> : <span class="keyword">sig</span></div>
      
      <div class="doc">
        
      <p>Run shell commands within Unixqueues</p>
      
        
      </div>
    
      
    <div class="sig">
      <div class="doc">
        
      <p>This module is <b>not thread-safe</b>. See the module <code>Shell_sys</code> for
more information.</p>
      
        
      </div>
    
      <div class="doc">
        
      <p><b>Signal handlers:</b> It is important to have a number of signal handlers
installed for proper function of the engines. It is recommended to
call the pair of functions <a href="../../../../ocamlnet.3.7.7/src/shell/shell_sys/">Shell_sys</a>.<a href="../../../../ocamlnet.3.7.7/src/shell/shell_sys/#/val:configure_job_handlers">configure_job_handlers</a> and
<a href="../../../../ocamlnet.3.7.7/src/shell/shell_sys/">Shell_sys</a>.<a href="../../../../ocamlnet.3.7.7/src/shell/shell_sys/#/val:install_job_handlers">install_job_handlers</a> for this purpose. This is not
done automatically.</p>
      
      <p>Note that this has a global side effect on the whole process, because
there is only one set of signal handlers.</p>
      
        
      </div>
    
      <div class="doc">
        <div class="region">
    <h1 class="section level_1">Engines</h1>
    </div>
        
      </div>
    
  <div class="region" id="/classtype:job_handler_engine_type">
  <a href="index.html#/classtype:job_handler_engine_type" class="anchor">#</a>
  
  <div class="classtype">
    <span class="keyword">class type</span> ['t] job_handler_engine_type = 
    <div class="inherit">
    <span class="keyword">inherit</span> ['t] <a href="../../../../ocamlnet.3.7.7/src/equeue/uq_engines/">Uq_engines</a>.<a href="../../../../ocamlnet.3.7.7/src/equeue/uq_engines/#/classtype:engine">engine</a>
    </div>
    
  <div class="region" id="/classtype:job_handler_engine_type/method:job">
  <a href="index.html#/classtype:job_handler_engine_type/method:job" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> job : <a href="../../../../ocamlnet.3.7.7/src/shell/shell_sys/">Shell_sys</a>.<a href="../../../../ocamlnet.3.7.7/src/shell/shell_sys/#/type:job">job</a>
  
      <div class="doc">
        
      <p>Returns the called job</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/classtype:job_handler_engine_type/method:job_instance">
  <a href="index.html#/classtype:job_handler_engine_type/method:job_instance" class="anchor">#</a>
  
  <div class="method">
  <span class="keyword">method</span> job_instance : <a href="../../../../ocamlnet.3.7.7/src/shell/shell_sys/">Shell_sys</a>.<a href="../../../../ocamlnet.3.7.7/src/shell/shell_sys/#/type:job_instance">job_instance</a>
  
      <div class="doc">
        
      <p>Returns the job instance</p>
      
        
      </div>
    
  </div>
  
  </div>
  
    
      <div class="doc">
        
      <p>This type of engine also returns the <code>job</code> and the <code>job_instance</code>.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/class:call_engine">
  <a href="index.html#/class:call_engine" class="anchor">#</a>
  
  <div class="class">
    <span class="keyword">class</span> call_engine : 
    ?ignore_error_code:bool option
    <span class="rarr"><span>-&gt;</span></span>
    
    ?mode:<a href="../../../../ocamlnet.3.7.7/src/shell/shell_sys/">Shell_sys</a>.<a href="../../../../ocamlnet.3.7.7/src/shell/shell_sys/#/type:group_mode">group_mode</a> option
    <span class="rarr"><span>-&gt;</span></span>
    
    ?stdin:<a href="../../../../ocamlnet.3.7.7/src/shell/shell/">Shell</a>.<a href="../../../../ocamlnet.3.7.7/src/shell/shell/#/type:producer">producer</a> option
    <span class="rarr"><span>-&gt;</span></span>
    
    ?stdout:<a href="../../../../ocamlnet.3.7.7/src/shell/shell/">Shell</a>.<a href="../../../../ocamlnet.3.7.7/src/shell/shell/#/type:consumer">consumer</a> option
    <span class="rarr"><span>-&gt;</span></span>
    
    ?stderr:<a href="../../../../ocamlnet.3.7.7/src/shell/shell/">Shell</a>.<a href="../../../../ocamlnet.3.7.7/src/shell/shell/#/type:consumer">consumer</a> option
    <span class="rarr"><span>-&gt;</span></span>
    
    <a href="../../../../ocamlnet.3.7.7/src/shell/shell_sys/">Shell_sys</a>.<a href="../../../../ocamlnet.3.7.7/src/shell/shell_sys/#/type:command">command</a> list
    <span class="rarr"><span>-&gt;</span></span>
    
    <a href="../../../../ocamlnet.3.7.7/src/equeue/unixqueue/">Unixqueue</a>.<a href="../../../../ocamlnet.3.7.7/src/equeue/unixqueue/#/classtype:event_system">event_system</a>
    <span class="rarr"><span>-&gt;</span></span>
    [<a href="../../../../ocamlnet.3.7.7/src/shell/shell_sys/">Shell_sys</a>.<a href="../../../../ocamlnet.3.7.7/src/shell/shell_sys/#/type:job_status">job_status</a>] <a href="index.html#/classtype:job_handler_engine_type">job_handler_engine_type</a>
    
    
    
    
    
    
    
    
      <div class="doc">
        
      <p>This engine corresponds to <a href="../../../../ocamlnet.3.7.7/src/shell/shell/">Shell</a>.<a href="../../../../ocamlnet.3.7.7/src/shell/shell/#/val:call">call</a>. The command list is
executed until the job is done. In this case,
the status of the engine changes to <code>`Done</code> or <code>`Error</code>.
If not <code>ignore_error_code</code>, failed jobs are reported by the
error status <code>`Error Subprocess_failure</code>. If <code>ignore_error_code</code>,
failed jobs are ignored, and result in the status <code>`Done</code>
(however, jobs terminated by signals are still reported as
errors).</p>
      
      <p>For the other arguments see <a href="../../../../ocamlnet.3.7.7/src/shell/shell/">Shell</a>.<a href="../../../../ocamlnet.3.7.7/src/shell/shell/#/val:call">call</a>.</p>
      
      <p>When the engine goes to <code>`Error</code> or <code>`Aborted</code>, the job
is terminated ( <a href="../../../../ocamlnet.3.7.7/src/shell/shell_sys/">Shell_sys</a>.<a href="../../../../ocamlnet.3.7.7/src/shell/shell_sys/#/val:abandon_job">abandon_job</a> ).</p>
      
        
      </div>
    
  </div>
  
  </div>
  
      <div class="doc">
        <div class="region">
    <h1 class="section level_1">Examples</h1>
    </div>
      <p>All examples presented for the [root:Shell] module can be easily rewritten
for <code>Shell_uq</code>. For example, to call &quot;ls&quot; and collect the result in a
buffer, use this piece of code:</p>
      <pre><code>   let ues = Unixqueue.create_unix_event_system();;
   let b = Buffer.create 10;;
   let e = new call_engine ~stdout:(Shell.to_buffer b) [ Shell.command &quot;ls&quot; ];;
   Unixqueue.run ues;;
   let r = Buffer.contents b;;</code></pre>
      <p>This means, one simply creates a <code>call_engine</code> instead of invoking
<a href="../../../../ocamlnet.3.7.7/src/shell/shell/">Shell</a>.<a href="../../../../ocamlnet.3.7.7/src/shell/shell/#/val:call">call</a>, and then runs the queue. Note that you must look at
<code>e#state</code> to find out whether the engine <code>e</code> produced an error, no
exception is raised in this case.</p>
      
      <p>It is allowed (and somehow the purpose of this module) to create
several job engines, and let them run in parallel.</p>
      
        
      </div>
    </div>
    <div class="outro"><span class="keyword">end</span></div>
    
  </div>
  
  </body>
</html>