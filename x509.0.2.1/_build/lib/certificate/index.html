<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="../../../../codoc.css"/>
    <title>Certificate</title>
  </head>
  <body>

  <div class="module codoc-doc">
      <a href="../../../">Up</a>
      <div class="intro"><h1 class="title"><span class="keyword">module</span> <a href="">Certificate</a></h1> : <span class="keyword">sig</span></div>
      
      <div class="doc">
        
      <p>Certificate validation as described in RFC5280 and RFC6125.</p>
      
        
      </div>
    
      
    <div class="sig">
  <div class="region" id="/type:certificate">
  <a href="index.html#/type:certificate" class="anchor">#</a>
  
  <div class="type">
    <span class="keyword">type</span> certificate
    
      <div class="doc">
        
      <p>abstract type of a certificate</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/type:stack">
  <a href="index.html#/type:stack" class="anchor">#</a>
  
  <div class="type">
    <span class="keyword">type</span> stack = <a href="index.html#/type:certificate">certificate</a> * <a href="index.html#/type:certificate">certificate</a> list
    
      <div class="doc">
        
      <p>a stack of certificates: the server certificate and a list of intermediate certificates</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/type:host">
  <a href="index.html#/type:host" class="anchor">#</a>
  
  <div class="type">
    <span class="keyword">type</span> host = [ <div class="cons">| `Strict <span class="keyword">of</span> string</div><div class="cons">| `Wildcard <span class="keyword">of</span> string</div> ]
    
      <div class="doc">
        
      <p>strict or wildcard matching of a server name</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:parse">
  <a href="index.html#/val:parse" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> parse : <a href="../../../../cstruct.1.5.0/_build/lib/cstruct/">Cstruct</a>.<a href="../../../../cstruct.1.5.0/_build/lib/cstruct/#/type:t">t</a> <span class="rarr"><span>-&gt;</span></span> <a href="index.html#/type:certificate">certificate</a> option
    
      <div class="doc">
        
      <p><code>parse cstruct</code> is <code>certificate option</code> where the <code>cstruct</code> is parsed to a high-level <code>certificate</code> or failure</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:parse_stack">
  <a href="index.html#/val:parse_stack" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> parse_stack : <a href="../../../../cstruct.1.5.0/_build/lib/cstruct/">Cstruct</a>.<a href="../../../../cstruct.1.5.0/_build/lib/cstruct/#/type:t">t</a> list <span class="rarr"><span>-&gt;</span></span> <a href="index.html#/type:stack">stack</a> option
    
      <div class="doc">
        
      <p><code>parse_stact cstructs</code> is <code>stack option</code> where the <code>cstructs</code> are parsed to high-level <code>certificates</code> or failure</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:cs_of_cert">
  <a href="index.html#/val:cs_of_cert" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> cs_of_cert : <a href="index.html#/type:certificate">certificate</a> <span class="rarr"><span>-&gt;</span></span> <a href="../../../../cstruct.1.5.0/_build/lib/cstruct/">Cstruct</a>.<a href="../../../../cstruct.1.5.0/_build/lib/cstruct/#/type:t">t</a>
    
      <div class="doc">
        
      <p><code>cs_of_cert certificate</code> is <code>cstruct</code> the binary representation of the <code>certificate</code>.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:asn_of_cert">
  <a href="index.html#/val:asn_of_cert" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> asn_of_cert : <a href="index.html#/type:certificate">certificate</a> <span class="rarr"><span>-&gt;</span></span> Asn_grammars.certificate
    
      <div class="doc">
        
      <p><code>asn_of_cert certificate</code> is <code>asn</code> the ASN.1 representation of the <code>certificate</code>.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/type:certificate_failure">
  <a href="index.html#/type:certificate_failure" class="anchor">#</a>
  
  <div class="type">
    <span class="keyword">type</span> certificate_failure = <table>
    <tr class="cons"><td>
  <div class="region" id="/type:certificate_failure/cons:InvalidCertificate">
  <a href="index.html#/type:certificate_failure/cons:InvalidCertificate" class="anchor">#</a>
  | InvalidCertificate
  </div>
  </td><td></td><td></td><td></td></tr><tr class="cons"><td>
  <div class="region" id="/type:certificate_failure/cons:InvalidSignature">
  <a href="index.html#/type:certificate_failure/cons:InvalidSignature" class="anchor">#</a>
  | InvalidSignature
  </div>
  </td><td></td><td></td><td></td></tr><tr class="cons"><td>
  <div class="region" id="/type:certificate_failure/cons:CertificateExpired">
  <a href="index.html#/type:certificate_failure/cons:CertificateExpired" class="anchor">#</a>
  | CertificateExpired
  </div>
  </td><td></td><td></td><td></td></tr><tr class="cons"><td>
  <div class="region" id="/type:certificate_failure/cons:InvalidExtensions">
  <a href="index.html#/type:certificate_failure/cons:InvalidExtensions" class="anchor">#</a>
  | InvalidExtensions
  </div>
  </td><td></td><td></td><td></td></tr><tr class="cons"><td>
  <div class="region" id="/type:certificate_failure/cons:InvalidPathlen">
  <a href="index.html#/type:certificate_failure/cons:InvalidPathlen" class="anchor">#</a>
  | InvalidPathlen
  </div>
  </td><td></td><td></td><td></td></tr><tr class="cons"><td>
  <div class="region" id="/type:certificate_failure/cons:SelfSigned">
  <a href="index.html#/type:certificate_failure/cons:SelfSigned" class="anchor">#</a>
  | SelfSigned
  </div>
  </td><td></td><td></td><td></td></tr><tr class="cons"><td>
  <div class="region" id="/type:certificate_failure/cons:NoTrustAnchor">
  <a href="index.html#/type:certificate_failure/cons:NoTrustAnchor" class="anchor">#</a>
  | NoTrustAnchor
  </div>
  </td><td></td><td></td><td></td></tr><tr class="cons"><td>
  <div class="region" id="/type:certificate_failure/cons:InvalidInput">
  <a href="index.html#/type:certificate_failure/cons:InvalidInput" class="anchor">#</a>
  | InvalidInput
  </div>
  </td><td></td><td></td><td></td></tr><tr class="cons"><td>
  <div class="region" id="/type:certificate_failure/cons:InvalidServerExtensions">
  <a href="index.html#/type:certificate_failure/cons:InvalidServerExtensions" class="anchor">#</a>
  | InvalidServerExtensions
  </div>
  </td><td></td><td></td><td></td></tr><tr class="cons"><td>
  <div class="region" id="/type:certificate_failure/cons:InvalidServerName">
  <a href="index.html#/type:certificate_failure/cons:InvalidServerName" class="anchor">#</a>
  | InvalidServerName
  </div>
  </td><td></td><td></td><td></td></tr><tr class="cons"><td>
  <div class="region" id="/type:certificate_failure/cons:InvalidCA">
  <a href="index.html#/type:certificate_failure/cons:InvalidCA" class="anchor">#</a>
  | InvalidCA
  </div>
  </td><td></td><td></td><td></td></tr>
    </table>
    
      <div class="doc">
        
      <p>possible failures while validating a certificate chain</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/type:key_type">
  <a href="index.html#/type:key_type" class="anchor">#</a>
  
  <div class="type">
    <span class="keyword">type</span> key_type = [ <div class="cons">| `RSA</div><div class="cons">| `DH</div><div class="cons">| `ECDH</div><div class="cons">| `ECDSA</div> ]
    
      <div class="doc">
        
      <p>variant of different public key types of a certificate</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:cert_type">
  <a href="index.html#/val:cert_type" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> cert_type : <a href="index.html#/type:certificate">certificate</a> <span class="rarr"><span>-&gt;</span></span> <a href="index.html#/type:key_type">key_type</a>
    
      <div class="doc">
        
      <p><code>cert_type certificate</code> is <code>key_type</code>, the public key type of the <code>certificate</code></p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:cert_usage">
  <a href="index.html#/val:cert_usage" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> cert_usage : <a href="index.html#/type:certificate">certificate</a> <span class="rarr"><span>-&gt;</span></span> Asn_grammars.Extension.key_usage list option
    
      <div class="doc">
        
      <p><code>cert_usage certificate</code> is <code>key_usage</code>, the key usage extensions of the <code>certificate</code></p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:cert_extended_usage">
  <a href="index.html#/val:cert_extended_usage" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> cert_extended_usage : <a href="index.html#/type:certificate">certificate</a> <span class="rarr"><span>-&gt;</span></span> Asn_grammars.Extension.extended_key_usage list option
    
      <div class="doc">
        
      <p><code>cert_extended_usage certificate</code> is <code>extended_key_usage</code>, the extended key usage extensions of the <code>certificate</code></p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:cert_hostnames">
  <a href="index.html#/val:cert_hostnames" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> cert_hostnames : <a href="index.html#/type:certificate">certificate</a> <span class="rarr"><span>-&gt;</span></span> string list
    
      <div class="doc">
        
      <p><code>cert_hostnames certficate</code> is <code>hostnames</code>, the list of hostnames mentioned in the <code>certifcate</code></p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:wildcard_matches">
  <a href="index.html#/val:wildcard_matches" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> wildcard_matches : string <span class="rarr"><span>-&gt;</span></span> <a href="index.html#/type:certificate">certificate</a> <span class="rarr"><span>-&gt;</span></span> bool
    
      <div class="doc">
        
      <p><code>wildcard_matches hostname certificate</code> is <code>result</code>, depending on whether the certificate contains a wildcard name which the hostname matches.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:verify_chain_of_trust">
  <a href="index.html#/val:verify_chain_of_trust" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> verify_chain_of_trust : ?host:<a href="index.html#/type:host">host</a> <span class="rarr"><span>-&gt;</span></span> ?time:float <span class="rarr"><span>-&gt;</span></span> anchors:<a href="index.html#/type:certificate">certificate</a> list <span class="rarr"><span>-&gt;</span></span> <a href="index.html#/type:stack">stack</a> <span class="rarr"><span>-&gt;</span></span> [ <div class="cons">| `Ok <span class="keyword">of</span> <a href="index.html#/type:certificate">certificate</a></div><div class="cons">| `Fail <span class="keyword">of</span> <a href="index.html#/type:certificate_failure">certificate_failure</a></div> ]
    
      <div class="doc">
        
      <p><code>verify_chain_of_trust ?host ?time ~anchors stack</code> is <code>validation_result</code>, where the certificate <code>stack</code> is verified using the algorithm from RFC5280: The validity period of the given certificates is checked against the <code>time</code>. The X509v3 extensions of the <code>stack</code> are checked, then a chain of trust from some <code>anchors</code> to the server certificate is validated. Also, the server certificate is checked to contain the given <code>hostname</code> in its subject alternative name extension (or common name if subject alternative name is not present), either using wildcard or strict matching as described in RFC6125. The returned certificate is the trust anchor.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:trust_fingerprint">
  <a href="index.html#/val:trust_fingerprint" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> trust_fingerprint : ?host:<a href="index.html#/type:host">host</a> <span class="rarr"><span>-&gt;</span></span> ?time:float <span class="rarr"><span>-&gt;</span></span> hash:<a href="../../../../nocrypto.0.3.0/_build/src/nocrypto/">Nocrypto</a>.<a href="../../../../nocrypto.0.3.0/_build/src/nocrypto/#/module:Hash">Hash</a>.<a href="../../../../nocrypto.0.3.0/_build/src/nocrypto/#/module:Hash/type:hash">hash</a> <span class="rarr"><span>-&gt;</span></span> fingerprints:(string * <a href="../../../../cstruct.1.5.0/_build/lib/cstruct/">Cstruct</a>.<a href="../../../../cstruct.1.5.0/_build/lib/cstruct/#/type:t">t</a>) list <span class="rarr"><span>-&gt;</span></span> <a href="index.html#/type:stack">stack</a> <span class="rarr"><span>-&gt;</span></span> [ <div class="cons">| `Ok <span class="keyword">of</span> <a href="index.html#/type:certificate">certificate</a></div><div class="cons">| `Fail <span class="keyword">of</span> <a href="index.html#/type:certificate_failure">certificate_failure</a></div> ]
    
      <div class="doc">
        
      <p><code>trust_fingerprint ?time hash fingerprints stack</code> is <code>validation_result</code>, where the certificate <code>stack</code> is verified (using same RFC5280 algorithm). Instead of trust anchors, a map from hostname to fingerprint is provided, where the certificate is checked against. Lookup in the fingerprint list is based on the provided host. If no host is provided, <code>validation_result</code> is <code>`Fail</code>.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:valid_cas">
  <a href="index.html#/val:valid_cas" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> valid_cas : ?time:float <span class="rarr"><span>-&gt;</span></span> <a href="index.html#/type:certificate">certificate</a> list <span class="rarr"><span>-&gt;</span></span> <a href="index.html#/type:certificate">certificate</a> list
    
      <div class="doc">
        
      <p><code>valid_cas ?time certificates</code> is <code>valid_certificates</code> which has filtered out those certificates which validity period does not contain <code>time</code>. Furthermore, X509v3 extensions are checked (basic constraints must be true).</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:common_name_to_string">
  <a href="index.html#/val:common_name_to_string" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> common_name_to_string : <a href="index.html#/type:certificate">certificate</a> <span class="rarr"><span>-&gt;</span></span> string
    
      <div class="doc">
        
      <p><code>common_name_to_string certificate</code> is <code>common_name</code> which is the extracted common name from the subject</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:certificate_failure_to_string">
  <a href="index.html#/val:certificate_failure_to_string" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> certificate_failure_to_string : <a href="index.html#/type:certificate_failure">certificate_failure</a> <span class="rarr"><span>-&gt;</span></span> string
    
      <div class="doc">
        
      <p><code>certificate_failure_to_string failure</code> is <code>failure_string</code> which is a string describing the <code>failure</code>.</p>
      
        
      </div>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:certificate_of_sexp">
  <a href="index.html#/val:certificate_of_sexp" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> certificate_of_sexp : Sexplib.Sexp.t <span class="rarr"><span>-&gt;</span></span> <a href="index.html#/type:certificate">certificate</a>
    
  </div>
  
  </div>
  
  <div class="region" id="/val:sexp_of_certificate">
  <a href="index.html#/val:sexp_of_certificate" class="anchor">#</a>
  
  <div class="val">
    <span class="keyword">val</span> sexp_of_certificate : <a href="index.html#/type:certificate">certificate</a> <span class="rarr"><span>-&gt;</span></span> Sexplib.Sexp.t
    
  </div>
  
  </div>
  </div>
    <div class="outro"><span class="keyword">end</span></div>
    
  </div>
  
  </body>
</html>